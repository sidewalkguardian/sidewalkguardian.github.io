<!DOCTYPE html>
<html lang="en">
   <head>
      <title>sidewalkguardian</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css">
   </head>
   <body>
      <!-- Start Content -->
      <div class="container py-3 text-center">
         <div class="card w-100">
            <div class="card-header bg-dark">
               <h3 class="text-white">里長查詢</h3>
            </div>
            <div class="card-body bg-transparents">
               <form id="form">
                  <div id="twzipcode" class="form-row">
                     <div class="form-group col">
                        <div data-role="county" data-style="form-control" data-name="county" data-value=""></div>
                     </div>
                     <div class="form-group col">
                        <div data-role="district" data-style="form-control" data-name="district" data-value=""></div>
                     </div>
                     <div class="form-group col">
                        <div data-role="zipcode" data-style="form-control" data-name="zipcode" data-value=""></div>
                     </div>
                  </div>
                  <div class="form-group">
                     <input type="text" class="form-control" id="address" placeholder="地址">
                  </div>
               </form>
            </div>
         </div>
      </div>
      <div class="container py-1 text-center">
         <button onclick="query()" type="button" class="btn-lg btn-dark">查詢</button>
         <button onclick="emptyForm()" type="button" class="btn-lg btn-dark">清空</button>
      </div>
      <div class="container mb-3">
         <div class = "form-control chat-messages" contenteditable="false" style="text-align: left; height: 300px; overflow-y: scroll;" readonly="readonly">
            <div id="output"></div>
         </div>
      </div>
      <!-- script -->
      <script type="text/javascript" src="list.json"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/jquery-twzipcode@1.7.14/jquery.twzipcode.min.js"></script>
      <script>
         var list;
         $.get('list.json', function(dataList) {
            list = dataList;
         });
         $("#twzipcode").twzipcode({
                         });
         function emptyForm()
         {
         	$('#form')[0].reset();
           document.getElementById("output").innerHTML = ``;
         }
         function query(){
            var county = $("#twzipcode").twzipcode('get', 'county');
            var district = $("#twzipcode").twzipcode('get', 'district');
            var address = $("#address").val();
            var content = "";
            for (var i = 0; i < list.length; i++) {
               if (address == "")
               {
                  if (county == list[i].county && district == list[i].town)
                  {
                     content = content + list[i].village + "  " + list[i].name + "  " + list[i].phone + "<br>"
                  }
               }
               else
               {
                  if (address.includes(list[i].village))
                  {
                     content = content + list[i].village + "  " + list[i].name + "  " + list[i].phone;
                     break;
                  }
               }
            }
            document.getElementById("output").innerHTML = content;
         }
      </script>
   </body>
</html>
